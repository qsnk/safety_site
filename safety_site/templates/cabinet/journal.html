{% extends 'cabinet/base_cabinet.html' %}
{% load static %}
{% block title %} Журнал {% endblock title %}

{% block content %}
<div class="row">
    <div class="col">
        <h2>Журнал</h2>
    </div>
    <div class="col col-auto">
        {% block sidebar %}
        <button class="btn btn-outline-dark" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasStart" aria-controls="offcanvasStart">
            Фильтры
        </button>
        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasStart" aria-labelledby="offcanvasStartLabel">
            <div class="offcanvas-header">
                <h5 id="offcanvasStartLabel">Фильтры</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                    {% if messages %}
                    <div class="messages">
                    {% for message in messages %}
                        <div class="error-message">
                            {{ message }}
                        </div>
                    {% endfor %}
                    </div>
                    {% endif %}
                    <button type="button" class="btn btn-outline-dark mt-4" id="clean_inputs">Очистить выбор</button>
                    <button type="submit" class="btn btn-outline-dark mt-4">Показать</button>
                </form>
            </div>
        </div>
        {% endblock sidebar %}
    </div>
</div>
<div class="row">
    <div class="col">
        {% block table %}
        <table class="table table-hover table-bordered">
            <thead class="table-secondary">
                <tr>
                    <th class="text-center" scope="col">Дата</th>
                    <th class="text-center" scope="col">Время</th>
                    <th class="text-center" scope="col">Нарушение</th>
                    <th scope="col">Описание</th>
                    <th class="text-center" scope="col">Фото</th>
                </tr>
            </thead>
            <tbody class="table-group-divider">
                {% for violation in page %}
                <tr>
                    <td class="text-center">{{ violation.date_time.date }}</td>
                    <td class="text-center">{{ violation.date_time.time }}</td>
                    <td class="text-center">{{ violation.violation_class }}</td>
                    <td>{{ violation.description }}</td>
                    <td class="text-center"><a href="{{ violation.photo.url }}" target="_blank" rel="noopener noreferrer"><img class="img-fluid rounded" width="100" height="100" src="{{ violation.photo.url }}" alt="{{ violation.photo.url }}"></a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endblock table %}
    </div>
</div>
<nav aria-label="Page navigation">
    <ul class="pagination">
        {% if page.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ page.previous_page_number }}">&laquo;</a></li>
        {% else %}
            <li class="page-item disabled"><a class="page-link" href="#">&laquo;</a></li>
        {% endif %}
        {% if page.paginator.num_pages > 10 %}
            <li class="page-item active"><a class="page-link" href="#">{{ page.number }}</a></li>
        {% else %}
            {% for button in page.paginator.page_range %}
                {% if page.number == button %}
                    <li class="page-item active"><a class="page-link" href="#">{{ page.number }}</a></li>
                {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ button }}">{{ button }}</a></li>
                {% endif %}
            {% endfor %}
        {% endif %}
        {% if page.has_next %}
            {% if violation_classes %}
                <li class="page-item"><a class="page-link" href="?violations={{ violation_classes }}&page={{ page.next_page_number }}">&raquo</a></li>
            {% else %}
                <li class="page-item"><a class="page-link" href="?page={{ page.next_page_number }}">&raquo</a></li>
            {% endif %}
        {% else %}
            <li class="page-item disabled"><a class="page-link" href="#">&raquo</a></li>
        {% endif %}
    </ul>
</nav>
{% endblock content %}